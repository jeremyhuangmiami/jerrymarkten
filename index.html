<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Jerry Mark Ten</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-dark: #202020;
      --bg-medium: #303030;
      --bg-light: #404040;
      --text-light: #f0f0f0;
      --text-medium: #b0b0b0;
      --accent-blue: #008CBA;
      --accent-blue-dark: #007095;
      --message-user-bg: var(--accent-blue);
      --message-bot-bg: var(--bg-medium);
      --loading-duration: 1.5s;
    }
    body { margin:0; font-family:'Inter',sans-serif; background:var(--bg-dark); color:var(--text-light); display:flex; flex-direction:column; height:100vh; overflow:hidden; }
    main { flex:1; display:flex; flex-direction:column; padding:1rem; overflow-y:auto; -webkit-overflow-scrolling:touch; padding-bottom:1.5rem; }
    .message { background:var(--message-bot-bg); border-radius:1.2rem; padding:0.9rem 1.2rem; margin:0.6rem 0; max-width:80%; word-wrap:break-word; line-height:1.5; font-size:0.95rem; box-shadow:0 2px 5px rgba(0,0,0,0.2); animation:fadeIn 0.3s ease-out; }
    .user { align-self:flex-end; background:var(--message-user-bg); color:white; border-bottom-right-radius:0.3rem; box-shadow:0 3px 8px rgba(0,0,0,0.3); }
    .bot { align-self:flex-start; border-bottom-left-radius:0.3rem; }
    .message.bot.thinking { display:flex; flex-direction:column; align-items:flex-start; justify-content:flex-start; }
    .thinking-gif { width:120px; height:120px; border-radius:1.0rem; object-fit:cover; display:block; margin-bottom:0.8rem; box-shadow:0 2px 5px rgba(0,0,0,0.2); }
    .loading-info { width:100%; display:flex; flex-direction:column; align-items:flex-start; }
    .loading-text { margin-bottom:0.5rem; font-weight:500; color:var(--text-medium); font-size:0.85em; }
    .loading-bar-container { width:100%; height:8px; background:var(--bg-light); border-radius:4px; overflow:hidden; }
    .loading-bar { height:100%; width:0%; background:var(--accent-blue); border-radius:4px; animation:loadingProgress var(--loading-duration) linear forwards; }
    @keyframes loadingProgress { from { width:0%; } to { width:100%; } }
    form { display:flex; padding:1rem; border-top:1px solid var(--bg-light); background:var(--bg-dark); align-items:center; }
    input[type="text"] { flex:1; background:var(--bg-medium); border:none; border-radius:2.5rem; padding:1rem 1.2rem; color:var(--text-light); font-size:1rem; outline:none; box-shadow:inset 0 1px 3px rgba(0,0,0,0.2); transition:background 0.2s ease, box-shadow 0.2s ease; }
    input[type="text"]::placeholder { color:var(--text-medium); opacity:0.7; }
    input[type="text"]:focus { background:var(--bg-light); box-shadow:inset 0 1px 3px rgba(0,0,0,0.3), 0 0 0 2px var(--accent-blue); }
    button { background:var(--accent-blue); color:white; border:none; margin-left:0.75rem; padding:0; border-radius:50%; font-size:1.4rem; cursor:pointer; display:flex; align-items:center; justify-content:center; min-width:3rem; min-height:3rem; box-shadow:0 3px 8px rgba(0,0,0,0.3); transition:background 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease; }
    button:hover { background:var(--accent-blue-dark); transform:translateY(-2px); box-shadow:0 5px 12px rgba(0,0,0,0.4); }
    button:active { transform:translateY(0); box-shadow:0 1px 3px rgba(0,0,0,0.2); }
    footer { text-align:center; font-size:0.7rem; color:var(--text-medium); padding:1rem 1rem 0.8rem; background:var(--bg-dark); border-top:1px solid var(--bg-light); }
    footer span { color:#888; font-style:italic; }
    .MathJax { color:var(--text-light) !important; }
    @keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }
  </style>
</head>
<body>
  <main id="chat"></main>
  <form id="chat-form">
    <input type="text" id="user-input" placeholder="Type your message..." required />
    <button type="submit">&#x27A4;</button>
  </form>
  <footer>
    jeremyworld.org | <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="ea808f989893878b98819e8f84aa808f988f87939d8598868ec485988d">[email&#160;protected]</a> | donate.jeremyworld.org<br>
    <span>AI for reference only</span>
  </footer>

  <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script>
  <script>
    const chat = document.getElementById('chat');
    const form = document.getElementById('chat-form');
    const input = document.getElementById('user-input');
    const thinkingGifUrl = 'https://i.giphy.com/koxVXnnmaQwllyovVG.webp';
    let currentThinkingBubble = null;
    const delayMilliseconds = 1500;
    document.documentElement.style.setProperty('--loading-duration', `${delayMilliseconds / 1000}s`);

    function addMessage(content, role, isThinking = false) {
      const div = document.createElement('div');
      div.className = `message ${role}`;
      if (isThinking) div.classList.add('thinking');
      div.innerHTML = content;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
      return div;
    }

    function showLoadingIndicatorWithGif() {
      const loadingHtml = `
        <img src="${thinkingGifUrl}" alt="Bot thinking..." class="thinking-gif" />
        <div class="loading-info">
          <div class="loading-text">Gathering information from Jeremy's brain...</div>
          <div class="loading-bar-container">
            <div class="loading-bar"></div>
          </div>
        </div>
      `;
      currentThinkingBubble = addMessage(loadingHtml, 'bot', true);
      chat.scrollTop = chat.scrollHeight;
    }

    function addInitialGreeting() {
      addMessage("Hi, I'm Jerry. How can I help?", 'bot');
    }

    document.addEventListener('DOMContentLoaded', addInitialGreeting);

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const message = input.value.trim();
      if (!message) return;
      addMessage(message, 'user');
      input.value = '';
      showLoadingIndicatorWithGif();

      setTimeout(async () => {
        try {
          const workerUrl = 'https://jerrymarkten.jeremyhuangmiami.workers.dev/';
          const res = await fetch(workerUrl, {
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body: JSON.stringify({
              model:"gemma2-9b-it",
              messages:[
                { role:"system", content:"You are a helpful assistant." },
                { role:"user", content: message }
              ],
              temperature:0.7
            })
          });
          if (!res.ok) throw new Error(`HTTP error! Status: ${res.status}`);
          const data = await res.json();
          const botResponseContent = data.choices?.[0]?.message?.content || "[Error: No reply]";
          if (currentThinkingBubble) {
            currentThinkingBubble.innerHTML = botResponseContent;
            currentThinkingBubble.classList.remove('thinking');
            if (typeof MathJax !== 'undefined') MathJax.typesetPromise([currentThinkingBubble]);
          }
        } catch (err) {
          if (currentThinkingBubble) {
            currentThinkingBubble.innerHTML = `[Error] ${err.message}`;
            currentThinkingBubble.classList.remove('thinking');
          } else addMessage(`[Error] ${err.message}`, 'bot');
        } finally { currentThinkingBubble = null; }
      }, delayMilliseconds);
    });
  </script>
</body>
</html>
